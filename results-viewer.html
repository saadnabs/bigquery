<html>
<head>
<script type="text/javascript"
	src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript" src="runs/results/newtest.csv-dataloader.js"></script>
<script type="text/javascript" src="js/listOfResults.js"></script>
<!--  src="/Users/nsaad/Workspaces/bigquery/runs/results/newtest.csv-dataloader.js" -->
<script type="text/javascript">

	google.charts.load('current', {'packages':['timeline']});
	google.charts.setOnLoadCallback(loadChart);

      function loadChart() {

        var newChartToLoad = document.getElementById("selectForResults");
        var selectedOption = newChartToLoad.options[newChartToLoad.selectedIndex];
        
      	var datasetName = listOfResults[selectedOption.value];
      	drawChart(datasetName);
      }
      
      function drawChart(datasetName) {
    	//console.log("in drawChart, dataset before: " + datasetName);
    	var container = document.getElementById('timeline');
    	console.log("container: " + container);
        var chart = new google.visualization.Timeline(container);
        var dataTable = new google.visualization.DataTable();

        //console.log("in drawChart, dataset after: " + datasetName);
        fillDataTable(dataTable, datasetName);
        
        var options = {
        		avoidOverlappingGridLines: false
              };
        
        chart.draw(dataTable, options);
      }

      function fillDataTable(dataTable, dataset) {
    	    dataTable.addColumn({ type: 'string', id: 'Count' });
    	    dataTable.addColumn({ type: 'string', id: 'President' });
    	    dataTable.addColumn({ type: 'date', id: 'Start' });
    	    dataTable.addColumn({ type: 'date', id: 'End' });
    	    dataTable.addRows(dataset);
      }

      function createNewJSSrc(filename) {

          var loc = window.location.pathname;
          var dir = loc.substring(0, loc.lastIndexOf('/') + 1);

    	  var fileref=document.createElement('script');
          fileref.setAttribute("type","text/javascript");
          fileref.setAttribute("src", "runs/results/" + filename); //(dir + "runs/results/" + filename)
          fileref.setAttribute("id", "jsDataRef");
          return fileref;
      }

      function loadSelectResults() {
          var selectInput = document.getElementById("selectForResults");
          //console.log("selectInput: " + selectInput);
          for (var key in listOfResults) {
			//console.log("key: " + key);
			var opt = document.createElement("option");
   	     	opt.value= key;
   	     	opt.innerHTML = key

   	     selectInput.appendChild(opt);
          }       
      }

      
    </script>
</head>
<body onload="loadSelectResults();loadChart();">
	<p>
		<label>Choose dataset to visualise: </label><select onchange="loadChart();" id="selectForResults"></select>
	</p>
	<div id="timeline" style="height: 1000%;"></div>
</body>
</html>